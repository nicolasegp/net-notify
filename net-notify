#!/bin/bash

DNS_SERVER=8.8.8.8
TOKEN='123456789:ABCDE1-ZYX987fghiGatoPerro'
CHAT='123456789'

INTERVALO=10
INTENTO=1
LF=$'\n'

clear
echo
echo -e "\e[93m [Revisando] \e[96m$DNS_SERVER"
echo

while true; do
	if ping -q -c 1 -W 1 $DNS_SERVER > /dev/null; then
		IP=$(curl -s 'ifconfig.me')
		echo -e "\e[92m Llegó el Internet"
		echo -e "\e[96m ● ${IP}"
		curl -s -X POST \
			"https://api.telegram.org/bot${TOKEN}/sendMessage" \
			-d parse_mode='Markdown' \
			-d chat_id=$CHAT \
			-d text="*Llegó el Internet*${LF}*• IP:* \`${IP}\`" > /dev/null
		break
	else
		echo -ne "\e[91m ● Intento: ${INTENTO}\r"
		INTENTO=$((INTENTO+1))
	fi
	sleep $INTERVALO
done
echo
